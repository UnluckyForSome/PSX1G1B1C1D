<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PSX1G1B1C1D Collection Browser</title>
  <style>
    :root {
      --bg: #0d1117;
      --surface: #161b22;
      --border: #30363d;
      --text: #e6edf3;
      --text-muted: #8b949e;
      --accent: #58a6ff;
      --accent-hover: #79b8ff;
    }
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 0;
      line-height: 1.5;
    }
    .header {
      position: sticky;
      top: 0;
      z-index: 10;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      padding: 1rem 1.5rem;
    }
    .header h1 {
      margin: 0 0 1rem 0;
      font-size: 1.25rem;
      font-weight: 600;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
    }
    .control-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .control-group label {
      color: var(--text-muted);
      font-size: 0.875rem;
    }
    select {
      background: var(--bg);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 0.5rem 2rem 0.5rem 0.75rem;
      font-size: 0.875rem;
      min-width: 12rem;
    }
    input[type="search"] {
      background: var(--bg);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 0.5rem 0.75rem;
      font-size: 0.875rem;
      min-width: 16rem;
    }
    input[type="search"]::placeholder {
      color: var(--text-muted);
    }
    input[type="search"]:focus,
    select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(88, 166, 255, 0.2);
    }
    .main {
      padding: 1rem 1.5rem 2rem;
      max-width: 900px;
      margin: 0 auto;
    }
    .status {
      color: var(--text-muted);
      font-size: 0.875rem;
      margin-bottom: 1rem;
    }
    .status.loading { color: var(--accent); }
    .status.error { color: #f85149; }
    .list {
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .list li {
      border-bottom: 1px solid var(--border);
    }
    .list li:last-child { border-bottom: none; }
    .list a {
      display: block;
      padding: 0.5rem 0;
      color: var(--accent);
      text-decoration: none;
      font-size: 0.875rem;
      word-break: break-all;
    }
    .list a:hover {
      color: var(--accent-hover);
      text-decoration: underline;
    }
    .list li.hidden { display: none; }
    .count {
      color: var(--text-muted);
      font-size: 0.8125rem;
    }
    .intro {
      font-size: 0.875rem;
      color: var(--text-muted);
      margin-bottom: 1.5rem;
      white-space: pre-line;
    }
    .intro a { color: var(--accent); text-decoration: none; }
    .intro a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <header class="header">
    <h1>PSX1G1B1C1D Collection Browser</h1>
    <div class="controls">
      <div class="control-group">
        <label for="collection">Collection</label>
        <select id="collection">
          <optgroup label="Library">
            <option value="library/2dbox">2D Box</option>
            <option value="library/2dbox-lq">2D Box (LQ)</option>
            <option value="library/3dbox">3D Box</option>
            <option value="library/3dbox-lq">3D Box (LQ)</option>
            <option value="library/disc">Disc</option>
            <option value="library/disc-lq">Disc (LQ)</option>
          </optgroup>
          <optgroup label="Composites">
            <option value="composites/psp-icon0">PSP icon0</option>
            <option value="composites/psp-pic0">PSP pic0</option>
          </optgroup>
        </select>
      </div>
      <div class="control-group">
        <label for="filter">Filter</label>
        <input type="search" id="filter" placeholder="Type to filter links…" autocomplete="off">
      </div>
    </div>
  </header>
  <main class="main">
    <p class="intro">-------------
This is an individual asset filter pointed at the <a href="https://github.com/UnluckyForSome/PSX1G1B1C1D">PSX1G1B1C1D repo</a> to assist in finding assets quickly!

Github truncates directories with 1000+ files and so using the file browser there isn't ideal — the files exist, but are not visible in the GitHub explorer. I've tried to make it as easy as possible to find individual assets as quickly as possible here.
-------------</p>
    <p class="status" id="status">Loading repository index…</p>
    <p class="count" id="count" aria-live="polite"></p>
    <ul class="list" id="list" role="list"></ul>
  </main>
  <script>
    (function () {
      // Repo config — works from main repo or fork when served from GitHub Pages
      var REPO = {
        owner: 'UnluckyForSome',
        repo: 'PSX1G1B1C1D',
        branch: 'main'
      };

      var collectionEl = document.getElementById('collection');
      var filterEl = document.getElementById('filter');
      var statusEl = document.getElementById('status');
      var countEl = document.getElementById('count');
      var listEl = document.getElementById('list');

      var repoTree = null;   // cached full tree from API
      var allEntries = [];   // { url, label } for current collection

      function setStatus(msg, className) {
        statusEl.textContent = msg;
        statusEl.className = 'status ' + (className || '');
      }

      function rawUrlFromPath(path) {
        var encoded = path.split('/').map(encodeURIComponent).join('/');
        return 'https://raw.githubusercontent.com/' + REPO.owner + '/' + REPO.repo + '/' + REPO.branch + '/' + encoded;
      }

      function fetchRepoTree() {
        if (repoTree) return Promise.resolve(repoTree);
        var url = 'https://api.github.com/repos/' + REPO.owner + '/' + REPO.repo + '/git/trees/' + REPO.branch + '?recursive=1';
        return fetch(url)
          .then(function (res) {
            if (!res.ok) throw new Error(res.status + ' ' + res.statusText);
            return res.json();
          })
          .then(function (data) {
            if (data.truncated) throw new Error('Repository tree is too large (truncated by API).');
            repoTree = data.tree || [];
            return repoTree;
          });
      }

      function loadCollection() {
        var collection = collectionEl.value;
        if (!collection) return;
        setStatus('Loading…', 'loading');
        listEl.innerHTML = '';
        allEntries = [];
        countEl.textContent = '';

        fetchRepoTree()
          .then(function (tree) {
            var prefix = collection + '/';
            tree.forEach(function (item) {
              if (item.type !== 'blob' || item.path.indexOf(prefix) !== 0) return;
              var filename = item.path.slice(prefix.length);
              if (!filename) return; // ignore bare directory entry
              allEntries.push({
                url: rawUrlFromPath(item.path),
                label: filename
              });
            });
            setStatus('');
            applyFilter();
          })
          .catch(function (err) {
            setStatus('Failed to load: ' + err.message, 'error');
          });
      }

      function applyFilter() {
        var q = (filterEl.value || '').trim().toLowerCase();
        var filtered = q
          ? allEntries.filter(function (e) { return e.label.toLowerCase().includes(q); })
          : allEntries;

        listEl.innerHTML = '';
        filtered.forEach(function (e) {
          var li = document.createElement('li');
          var a = document.createElement('a');
          a.href = e.url;
          a.textContent = e.label;
          a.target = '_blank';
          a.rel = 'noopener noreferrer';
          li.appendChild(a);
          listEl.appendChild(li);
        });

        countEl.textContent = filtered.length + ' of ' + allEntries.length + ' links';
      }

      collectionEl.addEventListener('change', loadCollection);
      filterEl.addEventListener('input', applyFilter);
      filterEl.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') {
          filterEl.value = '';
          filterEl.focus();
          applyFilter();
        }
      });

      loadCollection();
    })();
  </script>
</body>
</html>
